<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Go - Serverless Framework - Newrelic</title>
    <meta name="description" content="Sparktree - Devops posts & guides about interesting tech like Docker, Letsencrypt, Chef, Angular, Automation, API's or other topics that you should know about. " />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/assets/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/assets/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/assets/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/assets/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/assets/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/assets/favicon/mstile-310x310.png" />


    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/github-repos.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/lightgallery.min.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/justifiedGallery.min.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
    <!-- Everything inside the #post tags pulls data from the page -->
<!-- #post -->
    <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />


    
    <!-- Twitter page metadata -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@analogj">
    <meta name="twitter:creator" content="@analogj">
    <meta name="twitter:title" content="Sparktree - Go - Serverless Framework - Newrelic" />
    <meta name="twitter:description" content="Because I seem to be a glutton for punishment, I decided to build an API for my startup Fasten Health using Go + Serverless Framework +..." />
    <meta name="twitter:url" content="https://blog.thesparktree.com/go-serverless-framework-newrelic" />
    <meta name="twitter:image" content="https://blog.thesparktree.com/assets/images/cover_newrelic.png" />

    <!-- Opengraph page metadata -->
    <meta property="og:site_name" content="Sparktree" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Sparktree - Go - Serverless Framework - Newrelic" />
    <meta property="og:description" content="Because I seem to be a glutton for punishment, I decided to build an API for my startup Fasten Health using Go + Serverless Framework +..." />
    <meta property="og:url" content="https://blog.thesparktree.com/go-serverless-framework-newrelic" />
    <meta property="og:image" content="https://blog.thesparktree.com/assets/images/cover_newrelic.png" />

    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Website",
        "publisher": "Sparktree",
        "url": "https://blog.thesparktree.com/go-serverless-framework-newrelic",
        "image": "https://blog.thesparktree.com/assets/images/cover_newrelic.png",
        "description": "Because I seem to be a glutton for punishment, I decided to build an API for my startup Fasten Health using Go + Serverless Framework +..."
    }
    </script>

    

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Sparktree" href="/feed.xml" />
<!-- /post -->


    <meta name="google-site-verification" content="u9dNr8UKTVkH5x31v66leOs6mu10T2cm2RRbeYbOh4o" />
</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="javascript:void(0)" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-author " role="presentation"><a href="/author/analogj">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/cover_newrelic.png) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/logo-dark.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="javascript:void(0)"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-post">

        <header class="post-header">
            <h1 class="post-title">Go - Serverless Framework - Newrelic</h1>
            <section class="post-meta">
            <!-- <a href=''>Jason Kulatunga</a> -->
            <time class="post-date" datetime="2024-01-21">21 Jan 2024</time>
                <!-- [[tags prefix=" on "]] -->
                 
                <span class="tags-wrapper">
                
                    
                       <a href='/tag/golang'>Golang</a>,
                    
                
                    
                       <a href='/tag/serverless'>Serverless</a>,
                    
                
                    
                       <a href='/tag/newrelic'>Newrelic</a>
                    
                
                </span>
                
            </section>
        </header>

        <section class="post-content">
            
            <h4 class="toc"><i class="fa fa-file-text"></i> </h4>
            <ul class="toc__menu">
  <li><a href="#1-linking-aws--newrelic">1. Linking AWS &amp; Newrelic</a></li>
  <li><a href="#2-serverless-framework---golang-plugin">2. Serverless Framework - Golang Plugin</a></li>
  <li><a href="#3-serverless-framework---newrelic-lambda-layer-plugin">3. Serverless Framework - Newrelic Lambda Layer Plugin</a></li>
  <li><a href="#4-serverless-framework---iam-role--iam-roles-per-function">4. Serverless Framework - IAM Role &amp; IAM Roles Per Function</a></li>
  <li><a href="#5-application-code---metrics">5. Application Code - Metrics</a></li>
  <li><a href="#6-application-code---logs">6. Application Code - Logs</a></li>
</ul>
            

            <p>Because I seem to be a glutton for punishment, I decided to build an API for <a href="https://www.fastenhealth.com/">my startup Fasten Health</a> using Go + Serverless Framework + 
Newrelic. As expected this was difficult for a number of reasons:</p>

<ul>
  <li>Go is not a first class citizen in the Serverless Framework ecosystem. While it is supported, it is not as well documented as NodeJS.</li>
  <li>Newrelic’s AWS Lambda integration has gone through multiple iterations, and their documentation is not clear what is the “best” way to integrate.
    <ul>
      <li>Newrelic’s CloudWatch integration has been deprecated and replaced with a Lambda Layer.</li>
      <li>The Lambda layer integration <a href="https://github.com/newrelic/serverless-newrelic-lambda-layers/issues/334">requires code changes in Go, unlike the NodeJS, Python and other integrations</a></li>
      <li>The Lambda layer integration only works with the new <a href="https://aws.amazon.com/blogs/compute/migrating-aws-lambda-functions-from-the-go1-x-runtime-to-the-custom-runtime-on-amazon-linux-2/">Amazon Linux 2023 <code class="language-plaintext highlighter-rouge">provided</code> runtime</a> instead of the older but more commonly used <code class="language-plaintext highlighter-rouge">go1.x</code> runtime.</li>
    </ul>
  </li>
  <li>The Amazon Linux 2023 <code class="language-plaintext highlighter-rouge">provided</code> runtime has a requirement that the entrypoint binary is named <code class="language-plaintext highlighter-rouge">bootstrap</code>. This is difficult to do natively with the Serverless Framework, and requires a custom plugin]()</li>
  <li>There is no “agentless” integration for Newrelic. You must install the Newrelic agent in your Lambda function, and then configure your app/code to send data to Newrelic.</li>
</ul>

<p>Since there doesn’t seem to be much public documentation for how to get everything working correctly, I’ve documented my process below.</p>

<div class="github-widget" data-repo="AnalogJ/newrelic-serverless-go-playground"></div>

<h2 id="1-linking-aws--newrelic">1. Linking AWS &amp; Newrelic</h2>

<p>The Newrelic documentation for <a href="https://docs.newrelic.com/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/account-linking/">linking your AWS account</a> is pretty thorough,
however the “Linking accounts manually” alternative method was completely broken for me.</p>

<p>While I was unhappy installing another tool on my dev machine, the <code class="language-plaintext highlighter-rouge">newrelic-lambda</code> cli tool worked perfectly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>newrelic-lambda integrations <span class="nb">install</span> <span class="nt">--nr-account-id</span> YOUR_NR_ACCOUNT_ID <span class="se">\</span>
    <span class="nt">--nr-api-key</span> YOUR_NEW_RELIC_USER_KEY
</code></pre></div></div>

<p>Here’s how you get the Account ID and User Key for use with the CLI:</p>

<ul>
  <li><a href="https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/account-id/">YOUR_NR_ACCOUNT_ID</a>
    <ul>
      <li>From one.newrelic.com, click the user menu, and then go to: Administration &gt; Access management &gt; Accounts to see account IDs.</li>
    </ul>
  </li>
  <li><a href="https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/">YOUR_NEW_RELIC_USER_KEY</a>
    <ul>
      <li>Create and manage your API keys from the <a href="https://one.newrelic.com/launcher/api-keys-ui.api-keys-launcher">API keys UI page</a> so you can start observing your data right away</li>
      <li>NOTE: You must select a <code class="language-plaintext highlighter-rouge">USER</code> key, not an <code class="language-plaintext highlighter-rouge">INGEST - *</code> key, otherwise you’ll get an error when attemping to link your account.</li>
    </ul>
  </li>
</ul>

<p>Immediately after this step, you should be able to see your AWS account listed in the Newrelic UI. The <code class="language-plaintext highlighter-rouge">newrelic-lambda</code> cli tool will also 
create a <code class="language-plaintext highlighter-rouge">NEW_RELIC_LICENSE_KEY</code> secret in your AWS Secrets Manager, which is used by the Newrelic Lambda Layer.</p>

<blockquote>
  <p>NOTE: if all you care about is invocation and error metrics, you can stop here. The AWS Integration will allow you to see invocation and error metrics in Newrelic, but you won’t be able to see any custom metrics, logs or traces.
The following steps are required if you would like to see this additional telemetry in Newrelic.</p>
</blockquote>

<h2 id="2-serverless-framework---golang-plugin">2. Serverless Framework - Golang Plugin</h2>

<p>The first change we need to make to our Serverless Framework configuration is to add the <a href="https://github.com/mthenw/serverless-go-plugin">Serverless Framework Golang Plugin</a>.</p>

<p>This plugin allows us to build our Go binaries, and and is compatible with the Amazon Linux 2023 <code class="language-plaintext highlighter-rouge">provided</code> runtime which is required for the Newrelic Lambda Layer.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-go-plugin</span>
<span class="nn">...</span>

<span class="na">custom</span><span class="pi">:</span>
  <span class="na">go</span><span class="pi">:</span>
    <span class="na">baseDir</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">binDir</span><span class="pi">:</span> <span class="s">bin</span>
    <span class="na">cgo</span><span class="pi">:</span> <span class="m">0</span>
    <span class="c1"># compile command, make sure GOOS and GOARCH are set correctly</span>
    <span class="na">cmd</span><span class="pi">:</span> <span class="s">GOARCH=amd64 GOOS=linux go build -ldflags="-s -w"</span>
    <span class="c1"># the plugin compiles a function only if runtime is declared here (either on function or provider level)</span>
    <span class="na">supportedRuntimes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">provided.al2"</span><span class="pi">]</span>
    <span class="c1"># builds and archive function with only single "bootstrap" binary, required for `provided.al2` and `provided` runtime</span>
    <span class="na">buildProvidedRuntimeAsBootstrap</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div>

<h2 id="3-serverless-framework---newrelic-lambda-layer-plugin">3. Serverless Framework - Newrelic Lambda Layer Plugin</h2>

<p>Next, we need to add the <a href="https://github.com/newrelic/serverless-newrelic-lambda-layers">Serverless Framework Newrelic Lambda Layer Plugin</a></p>

<p>This plugin allows us to add the Newrelic Lambda Layer to our function, which contains a Newrelic agent that our Newrelic <code class="language-plaintext highlighter-rouge">go-agent</code> sdk will use send data to Newrelic.</p>

<p>We need to install the Serverless plugin, specify the <code class="language-plaintext highlighter-rouge">provider</code> runtime and then specify the configuration.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">accountId</code> - this is the <code class="language-plaintext highlighter-rouge">YOUR_NR_ACCOUNT_ID</code> value from Step 1</li>
  <li><code class="language-plaintext highlighter-rouge">apiKey</code> - this is the <code class="language-plaintext highlighter-rouge">YOUR_NEW_RELIC_USER_KEY</code> value from Step 1</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-newrelic-lambda-layers</span>
<span class="nn">...</span>

<span class="na">provider</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">aws</span>
  <span class="na">runtime</span><span class="pi">:</span> <span class="s">provided.al2</span>

<span class="na">custom</span><span class="pi">:</span>
  <span class="na">newRelic</span><span class="pi">:</span>
    <span class="na">accountId</span><span class="pi">:</span> <span class="s">YOUR_NR_ACCOUNT_ID</span>
    <span class="na">apiKey</span><span class="pi">:</span> <span class="s">YOUR_NEW_RELIC_USER_KEY</span>
    <span class="na">debug</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h2 id="4-serverless-framework---iam-role--iam-roles-per-function">4. Serverless Framework - IAM Role &amp; IAM Roles Per Function</h2>

<p>While the steps above are documented in various locations on the internet, it wasn’t clear to me that the Newrelic Lambda Layer seems to require a AWS Secret Manager integration
to retrieve the Newrelic License Key. Initially, I tried manually specifying the key using <code class="language-plaintext highlighter-rouge">newrelic.ConfigLicense(os.Getenv("NEW_RELIC_LICENSE_KEY"))</code> to configure the Newrelic <code class="language-plaintext highlighter-rouge">go-agent</code> sdk, but that didn’t work.
The solution was to specify the an IAM Role for the Serverless function, giving it permissions to AWS Secret Manager to pull the <code class="language-plaintext highlighter-rouge">NEW_RELIC_LICENSE_KEY</code> secret.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-iam-roles-per-function</span>

<span class="nn">...</span>

<span class="na">functions</span><span class="pi">:</span>
  <span class="na">healthcheck</span><span class="pi">:</span>
    <span class="na">handler</span><span class="pi">:</span> <span class="s">cmd/health/health.go</span>
    <span class="na">iamRoleStatements</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Allow"</span>
        <span class="na">Action</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">secretsmanager:GetSecretValue"</span>
        <span class="c1"># This is the secret that was created by the newrelic-lambda cli tool. </span>
        <span class="c1"># To find it, open the AWS Console, and go to: Secrets Manager &gt; Secrets &gt; Find "NEW_RELIC_LICENSE_KEY", then copy the ARN</span>
        <span class="na">Resource</span><span class="pi">:</span> <span class="s2">"</span><span class="s">arn:aws:secretsmanager:us-east-1:1234567890:secret:NEW_RELIC_LICENSE_KEY-XXXXX"</span>
    <span class="na">events</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">httpApi</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/health</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">get</span>

</code></pre></div></div>

<h2 id="5-application-code---metrics">5. Application Code - Metrics</h2>

<p>Finally, we need to modify our Serverless function code to use the <code class="language-plaintext highlighter-rouge">go-agent</code> sdk.</p>

<p>Notice how the <code class="language-plaintext highlighter-rouge">newrelic.NewApplication()</code> call has minimal configuration options specified (compared to the <a href="https://github.com/newrelic/go-agent/blob/master/v3/integrations/nrawssdk-v2/example/main.go">Raw AWS SDK Example</a>)</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>
<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/newrelic/go-agent/v3/integrations/nrlambda"</span>
	<span class="n">newrelic</span> <span class="s">"github.com/newrelic/go-agent/v3/newrelic"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">handler</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// The nrlambda handler instrumentation will add the transaction to the</span>
	<span class="c">// context.  Access it using newrelic.FromContext to add additional</span>
	<span class="c">// instrumentation.</span>
	<span class="n">txn</span> <span class="o">:=</span> <span class="n">newrelic</span><span class="o">.</span><span class="n">FromContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
	<span class="n">txn</span><span class="o">.</span><span class="n">AddAttribute</span><span class="p">(</span><span class="s">"userLevel"</span><span class="p">,</span> <span class="s">"gold"</span><span class="p">)</span>
	<span class="n">txn</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span><span class="o">.</span><span class="n">RecordCustomEvent</span><span class="p">(</span><span class="s">"MyEvent"</span><span class="p">,</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span>
		<span class="s">"zip"</span><span class="o">:</span> <span class="s">"zap"</span><span class="p">,</span>
	<span class="p">})</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"hello world"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// Pass nrlambda.ConfigOption() into newrelic.NewApplication to set</span>
	<span class="c">// Lambda specific configuration settings including</span>
	<span class="c">// Config.ServerlessMode.Enabled.</span>
	<span class="n">app</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">newrelic</span><span class="o">.</span><span class="n">NewApplication</span><span class="p">(</span><span class="n">nrlambda</span><span class="o">.</span><span class="n">ConfigOption</span><span class="p">())</span>
	<span class="k">if</span> <span class="no">nil</span> <span class="o">!=</span> <span class="n">err</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"error creating app (invalid config):"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="c">// nrlambda.Start should be used in place of lambda.Start.</span>
	<span class="c">// nrlambda.StartHandler should be used in place of lambda.StartHandler.</span>
	<span class="n">nrlambda</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://blog.thesparktree.com/assets/images/newrelic/metrics.png" alt="metrics" /></p>

<h2 id="6-application-code---logs">6. Application Code - Logs</h2>

<p>If you had deployed the Serverless function defined in Step 5 as-is, you would see your metrics, however you would not see any logs in Newrelic.
This is because you’re missing the last bit of configuration to enable the Newrelic Lambda Extension to send logs to Newrelic.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>
<span class="k">import</span> <span class="p">(</span>
  <span class="s">"context"</span>
  <span class="s">"fmt"</span>

  <span class="s">"github.com/newrelic/go-agent/v3/integrations/nrlambda"</span>
  <span class="n">newrelic</span> <span class="s">"github.com/newrelic/go-agent/v3/newrelic"</span>
<span class="p">)</span>
<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="o">...</span>
	
	
	<span class="n">app</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">newrelic</span><span class="o">.</span><span class="n">NewApplication</span><span class="p">(</span>
        <span class="n">nrlambda</span><span class="o">.</span><span class="n">ConfigOption</span><span class="p">(),</span>
        
		<span class="c">// This is the configuration that enables the Newrelic Lambda Extension to send logs to Newrelic</span>
        <span class="n">newrelic</span><span class="o">.</span><span class="n">ConfigAppLogForwardingEnabled</span><span class="p">(</span><span class="no">true</span><span class="p">),</span>
		<span class="k">func</span><span class="p">(</span><span class="n">config</span> <span class="o">*</span><span class="n">newrelic</span><span class="o">.</span><span class="n">Config</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">logrus</span><span class="o">.</span><span class="n">SetLevel</span><span class="p">(</span><span class="n">logrus</span><span class="o">.</span><span class="n">DebugLevel</span><span class="p">)</span>
			<span class="n">config</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">nrlogrus</span><span class="o">.</span><span class="n">StandardLogger</span><span class="p">()</span>
		<span class="p">},</span>
	<span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://blog.thesparktree.com/assets/images/newrelic/logs.png" alt="metrics" /></p>

<h1 id="fin">Fin</h1>

<p>That’s it! Trigger a deployment, visit your Serverless function &amp; you should now be able to see your Serverless function metrics and logs in Newrelic.</p>

<p>If you encounter any issues, refer to my <a href="https://github.com/AnalogJ/newrelic-serverless-go-playground">GitHub repository</a> for a working example. Happy coding!</p>

<div class="github-widget" data-repo="AnalogJ/newrelic-serverless-go-playground"></div>

<h1 id="references">References</h1>
<ul>
  <li><a href="https://github.com/newrelic/newrelic-lambda-extension/blob/main/examples/sam/go/main.go">Newrelic Lambda Extension Example</a></li>
  <li><a href="https://github.com/newrelic/go-agent/blob/master/v3/integrations/nrlambda/example/main.go">Newrelic Go-Agent SDK Lamdba Example</a></li>
  <li><a href="https://github.com/newrelic/go-agent/blob/master/GUIDE.md#full-list-of-config-options-and-application-settings">Newrelic Go-Agent SDK Full Options</a></li>
  <li><a href="https://github.com/newrelic/docs-website/blob/develop/src/content/docs/serverless-function-monitoring/aws-lambda-monitoring/get-started/compatibility-requirements-aws-lambda-monitoring.mdx">Newrelic Lambda Layer Supported Runtimes</a></li>
  <li><a href="https://docs.newrelic.com/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/account-linking/#troubleshooting">Newrelic Troubleshooting Guide for Lambdas</a></li>
  <li><a href="https://forum.newrelic.com/s/hubtopic/aAX8W0000008eWv/lambda-troubleshooting-framework-troubleshooting-lambda-part-1">Newrelic Troubleshooting Guide for Lambdas - Forum Post - Part 1</a></li>
  <li><a href="https://docs.newrelic.com/docs/serverless-function-monitoring/aws-lambda-monitoring/enable-lambda-monitoring/enable-serverless-monitoring-aws-lambda-legacy/">Newrelic Legacy manual instrumentation for Lambda monitoring</a></li>
  <li><a href="https://github.com/newrelic/serverless-newrelic-lambda-layers">Newrelic Lambda Layer Plugin for Serverless Framework</a></li>
  <li><a href="https://github.com/mthenw/serverless-go-plugin">Serverless Framework Go Plugin</a></li>
</ul>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/analogj" style="background-image: url(/assets/images/analogj.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/analogj">Jason Kulatunga</a></h4>
                
                
                    <p> Devops & Infrastructure guy @Gusto (ex-Adobe). I write about, and play with, all sorts of new tech. All opinions are my own.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> San Francisco, CA</span> 
                    <span class="author-link icon-link"><a href="https://blog.thesparktree.com"> blog.thesparktree.com</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Go - Serverless Framework - Newrelic&amp;url=https://blog.thesparktree.com/go-serverless-framework-newrelic"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.thesparktree.com/go-serverless-framework-newrelic"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.thesparktree.com/go-serverless-framework-newrelic"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

            <!-- Subscribe -->
            
            <!-- Begin MailChimp Signup Form -->
<section class="gh-subscribe">
    <h3 class="gh-subscribe-title">Subscribe to Sparktree</h3>
    <p>Get the latest posts delivered right to your inbox.</p>

    <form action="//thesparktree.us12.list-manage.com/subscribe/post?u=8600f4c40c69856634ec2a2c8&amp;id=db2fcf78fd" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div class="mc-field-group form-group">
            <input type="email" value="" name="EMAIL" class="subscribe-email required email" id="mce-EMAIL">
        </div>
        <button class="" type="submit">Subscribe</button>

        <input type="hidden" name="SIGNUP" value="/go-serverless-framework-newrelic" id="mce-SIGNUP">
        <div id="mce-responses" class="clear">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8600f4c40c69856634ec2a2c8_db2fcf78fd" tabindex="-1" value=""></div>
    </form>


    <span class="gh-subscribe-rss">or subscribe <a href="http://cloud.feedly.com/#subscription/feed/https://blog.thesparktree.com/feed.xml">via RSS</a> with Feedly!</span>
</section>


<!--End mc_embed_signup-->
            
            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        this.page.url = 'https://blog.thesparktree.com/go-serverless-framework-newrelic'; //'a unique URL for each page where Disqus is present'
        this.page.title = 'Go - Serverless Framework - Newrelic';
    };

    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//sparktree.disqus.com/embed.js';  // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/cover_arm_docker_github.png)" href="/docker-multi-arch-github-actions">
            <section class="post">
                <h2>Building Multi-Arch Docker Images via Github Actions</h2>
                <p>I recently found myself needing to generate a multi-arch Docker image for one of my...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Sparktree</a> &copy; 2024</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/github-repos.min.js"></script>
    <script type="text/javascript" src="/assets/js/lightgallery.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.justifiedGallery.min.js"></script>

    <script type="text/javascript" src="/assets/js/index.js"></script>


    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-33233417-3', 'auto');
        ga('send', 'pageview');

     </script>

     <!-- Sumo -->
    <script src="https://load.sumome.com/" data-sumo-site-id="94ea7fd31eeea5aeae29f85e1ab1c01e52c9cc1aaf11deefb55faf0f57bdf2b4" async="async"></script>

</body>
</html>
